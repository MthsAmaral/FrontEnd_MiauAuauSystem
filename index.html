<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <title>Página Inicial</title>
  <link rel="stylesheet" href="./css/indexNovo.css" />
  <link rel="stylesheet" href="./css/modalDoacao.css">

  <!-- FONTE  -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">

  <!--Alerts-->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.19.1/dist/sweetalert2.min.css" rel="stylesheet">
  </link>
  <link rel="stylesheet" href="./css/stylesAlerts.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.19.1/dist/sweetalert2.all.min.js"></script>

  <script src="./ControllerJs/acessoController.js"></script>
  <script src="./ControllerJs/doacaoController.js"></script>
</head>

<body onload="verificarPrivilegio()">
  <nav id="inicio" class="navbar">
    <a href="index.html" style="text-decoration: none;">
      <div class="logo-container">
        <span class="logo-text">Grupo MiauAuau</span>
        <img src="img/logo.png" alt="Sistema MiauAuau" class="logo" />
      </div>
    </a>
    <ul id="nav" class="nav-links" style="align-items: center;">
      <li class="nav-item dropdown-auaumiau">
        <a id="userMenu" class="nav-link dropdown-toggle-auaumiau"><i class="fa-solid fa-user"></i> Acesse
          sua conta</a>
        <ul class="dropdown-menu-auaumiau">
          <li><a class="dropdown-item-auaumiau" href="./TelasFundamentais/telaLogin.html">Entrar</a></li>
          <li><a class="dropdown-item-auaumiau" href="./TelasFundamentais/telaCadastro.html">Cadastre-se</a></li>
        </ul>
      </li>
      <li>
        <a href="adocao.html" class="adopt2-button2">Quero Adotar</a>
      </li>
      <li>
        <a href="#doacao" class="adopt2-button2">Quero Doar</a>
      </li>
      <li><a href="#inicio">Início</a></li>
      <li><a href="#sobre">Sobre</a></li>
      <li><a href="#sobre">Contato</a></li>
    </ul>
  </nav>
  <main>

    <div class="carrosel">
      <div class="carousel-container">
        <div class="carousel">
          <img src="img/banner1.png" class="carousel-slide active" alt="Banner 1">
          <img src="img/banner2.png" class="carousel-slide" alt="Banner 2">
          <img src="img/banner3.png" class="carousel-slide" alt="Banner 3">

          <button class="nav prev">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
              class="bi bi-arrow-left-short" viewBox="0 0 16 16">
              <path fill-rule="evenodd"
                d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5" />
            </svg>
          </button>
          <button class="nav next">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
              class="bi bi-arrow-right-short" viewBox="0 0 16 16">
              <path fill-rule="evenodd"
                d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8" />
            </svg>
          </button>

        </div>
        <div class="indicators">
          <span class="dot active"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
      </div>
      </section>
      <section class="info-section">
        <div class="info-container">
          <div class="info-box">
            <i class="fas fa-paw"></i>
            <h3>Adoção Responsável</h3>
            <p>Adote com consciência e mude uma vida com amor e carinho.</p>
          </div>
          <div class="info-box">
            <i class="fas fa-heart"></i>
            <h3>Conecte com Amor</h3>
            <p>Encontre o companheiro ideal entre centenas de animais resgatados.</p>
          </div>
          <div class="info-box">
            <i class="fas fa-shield-alt"></i>
            <h3>Segurança e Apoio</h3>
            <p>Todo o processo é acompanhado por nossa equipe especializada.</p>
          </div>
        </div>
      </section>
      <section class="adopt-section">
        <div class="banner-card">
          <img src="img/cat.png" alt="Gato para adoção" class="animal-img left">
          <div class="banner-text">
            <h3>Se interessou?</h3>
            <p>Adote um animalzinho e transforme duas vidas: a dele e a sua.</p>
            <button class="adopt-btn" onclick="window.location.href='adocao.html'">Quero Adotar</button>
          </div>
          <img src="img/dog.png" alt="Cachorro para adoção" class="animal-img right">
        </div>
      </section>
      <section class="impact-section">
        <h2 class="impact-title">
          Apoie e faça parte da nossa ação voluntária.<br />
          <span class="impact-subtitle">Toda ajuda conta e faz muita diferença.</span>
        </h2>
        <div class="impact-metrics">
          <div class="impact-card">
            <p class="impact-number" id="moneyRaised">R$ 0</p>
            <p class="impact-label">Doações Recebidas</p>
          </div>
          <div class="impact-card">
            <p class="impact-number" id="rescuedCount">0</p>
            <p class="impact-label">Animais Resgatados</p>
          </div>
          <div class="impact-card">
            <p class="impact-number" id="volunteersCount">0</p>
            <p class="impact-label">Voluntários Ativos</p>
          </div>
        </div>
      </section>
  </main>
  <div id="doacao" class="cta-section">
    <h2>Ajude a salvar vidas agora</h2>
    <p>Com apenas <strong>R$10</strong>, você contribui para o cuidado de animais resgatados</p>
    <button class="cta-button" onclick="abrirModal()">Faça uma doação</button>
  </div>

  <!-- Modal de Cadastro de Doação -->
  <div id="modalDoacao" class="modal-overlay" onclick="fecharModalFora(event)">
    <div class="modal-conteudo" style="max-width: 450px;">
      <span class="fechar" onclick="fecharModal()">&times;</span>

      <div class="modal-banner">
        <img src="img/banner_doe.png" alt="Banner Doe" style="max-width: 100%; border-radius: 8px;">
      </div>

      <h2 style="margin-top: 15px; font-weight: 700; text-align: center;">Agende Sua Doação</h2>

      <form id="fdoacao" class="d-flex flex-column gap-3 mt-3">

        <input type="hidden" id="codDoacao" name="codDoacao" />
        <input type="hidden" id="cod_usuario" name="cod_usuario" />
        <input type="hidden" id="status" name="status" value="Pendente" />

        <!-- Data -->
        <div>
          <label class="form-label fw-semibold">Data da Solicitação:</label>
          <input type="date" id="data" name="data" class="form-control" required />
        </div>

        <!-- Valor -->
        <div>
          <label class="form-label fw-semibold">Valor (R$):</label>
          <input type="number" id="valor" name="valor" class="form-control" min="1" step="0.01" placeholder="Ex: 10.00"
            required />
        </div>

        <!-- Botões -->
        <div class="d-flex justify-content-between gap-3">
          <button type="button" class="btn btn-secondary w-100" onclick="fecharModal()">
            <i class="fa-solid fa-xmark"></i> Cancelar
          </button>

          <button type="button" class="btn btn-success w-100" onclick="validarCampos()">
            <i class="fa-solid fa-check"></i> Confirmar
          </button>
        </div>
      </form>
    </div>
  </div>

  <footer id="sobre">
    <div class="footer-container">
      <div class="footer-column">
        <h4>Sobre a ONG</h4>
        <p>Somos uma associação sem fins lucrativos com intuito de ajudar animais abandonados e em situações de
          vulnerabilidade. Realizamos ações, bingos e rifas para arrecadar fundos a fim de custear as despesas.</p>
        <br>
        <h4>Nossa Missão</h4>
        <p>Transformando vidas com amor e cuidado aos animais resgatados.</p>
      </div>
      <div class="footer-column">
        <h4>Redes Sociais</h4>
        <ul>
          <li><a href="https://www.instagram.com/miauauau_rf/?igsh=bHBhbG94ZG54NWtr#" target="_blank"><i
                class="fa-brands fa-instagram"></i> miauauau_rf</a></li>
          <li><a href="https://api.whatsapp.com/send/?phone=5518997605428&text&type=phone_number&app_absent=0"
              target="_blank"><i class="fa-brands fa-whatsapp"></i> +55 18 99760-5428</a></li>
          <li><a href="mailto:grupomiauauau.rf@gmail.com" target="_blank"><i class="fa-regular fa-envelope"></i>
              grupomiauauau.rf@gmail.com</a></li>
          <br>
          <li>
            <h4>Endereço</h4>
          </li>
          <li><a href="https://maps.app.goo.gl/dRZkx7aPabJpoVXA6" target="_blank"><i
                class="fa-solid fa-location-dot"></i> Teófilo Otoni, 515, Centro, Regente Feijó/SP</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h4>Como Ajudar</h4>
        <ul>
          <li><a href="adocao.html#adocao"><i class="fa-solid fa-paw"></i> Quero Adotar</a></li>
          <li><a href="#doacao"><i class="fa-solid fa-donate"></i> Quero Doar </a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; 2025 Grupo Miau Au Au.
    </div>
  </footer>
  <button id="scrollTopBtn" onclick="scrollToTop()">
    <i class="fa-solid fa-caret-up"></i>
  </button>

  <script>
    const slides = document.querySelectorAll('.carousel-slide');
    const dots = document.querySelectorAll('.dot');
    let currentIndex = 0;

    function showSlide(index) {
      slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === index);
        dots[i].classList.toggle('active', i === index);
      });
      currentIndex = index;
    }

    document.querySelector('.prev').addEventListener('click', () => {
      const index = (currentIndex - 1 + slides.length) % slides.length;
      showSlide(index);
    });

    document.querySelector('.next').addEventListener('click', () => {
      const index = (currentIndex + 1) % slides.length;
      showSlide(index);
    });

    function animateCount(id, end, isCurrency = false) {
      const el = document.getElementById(id);
      let start = 0;
      const duration = 2000;
      const stepTime = 20;
      const steps = duration / stepTime;
      const increment = end / steps;

      const counter = setInterval(() => {
        start += increment;
        if (start >= end) {
          start = end;
          clearInterval(counter);
        }
        el.textContent = isCurrency
          ? 'R$ ' + start.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ".")
          : Math.floor(start);
      }, stepTime);
    }
    animateCount('moneyRaised', 48250, true);
    animateCount('rescuedCount', 189);
    animateCount('volunteersCount', 72);

    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }
    window.onscroll = function () {
      const scrollTopBtn = document.getElementById('scrollTopBtn');
      if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
        scrollTopBtn.classList.add('show');
      } else {
        scrollTopBtn.classList.remove('show');
      }
    };

    function abrirModal() {
      const token = localStorage.getItem("token");
      if (!token) {
        Swal.fire({
          icon: "warning",
          title: "Você precisa estar logado",
          text: "Por favor, faça login para realizar uma doação.",
          confirmButtonText: "Ir para login"
        }).then(() => {
          window.location.href = "TelasFundamentais/telaLogin.html";
        });
        return;
      }

      // Valida se o token está expirado
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const payload = JSON.parse(window.atob(base64));
      const now = Math.floor(Date.now() / 1000);

      if (payload.exp && payload.exp < now) {
        Swal.fire({
          icon: "error",
          title: "Sessão Expirada",
          text: "Por favor, faça login novamente.",
          confirmButtonText: "Ok"
        }).then(() => {
          localStorage.removeItem("token");
          window.location.href = "TelasFundamentais/telaLogin.html";
        });
        return;
      }

      // ✅ Se estiver tudo certo, preenche o cod_usuario
      const codUsuario = payload.cod_usuario;
      document.getElementById("cod_usuario").value = codUsuario;

      // ✅ Agora sim, abre a modal
      document.getElementById("modalDoacao").style.display = "flex";
    }


    function fecharModal() {
      document.getElementById("modalDoacao").style.display = "none";
    }

    function fecharModalFora(event) {
      if (event.target.id === "modalDoacao") {
        fecharModal();
      }
    }

    const Toast = Swal.mixin({
      toast: true,
      position: 'top',
      iconColor: 'white',
      customClass: {
        popup: 'colored-toast',
      },
      showConfirmButton: false,
      timer: 1500,
      timerProgressBar: true,
    });

    if (sessionStorage.getItem('usuarioNaoAutenticado') == 'true') {
      Toast.fire({
        icon: 'error',
        title: 'Ops! Você não está logado',
      });
    }
    else
      if (sessionStorage.getItem('acessoNegado') == 'true') {
        Toast.fire({
          icon: 'error',
          title: 'Acesso Negado',
        });

      }
    sessionStorage.removeItem('acessoNegado');
    sessionStorage.removeItem('usuarioNaoAutenticado');
  </script>
</body>

</html>